<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UserController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">spring-boot-skeleton</a> &gt; <a href="index.source.html" class="el_package">com.nnk.springboot.controllers</a> &gt; <span class="el_source">UserController.java</span></div><h1>UserController.java</h1><pre class="source lang-java linenums">package com.nnk.springboot.controllers;

import com.nnk.springboot.domain.User;
import com.nnk.springboot.repositories.UserRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import jakarta.validation.Valid;

/**
 * Contrôleur Spring MVC pour la gestion des utilisateurs de l'application.
 * 
 * &lt;p&gt;Ce contrôleur gère l'ensemble des opérations CRUD (Create, Read, Update, Delete)
 * pour les entités User via une interface web. Il inclut la gestion sécurisée des
 * mots de passe avec chiffrement BCrypt et la validation des données utilisateur.&lt;/p&gt;
 * 
 * &lt;p&gt;Fonctionnalités principales :&lt;/p&gt;
 * &lt;ul&gt;
 *   &lt;li&gt;Affichage de la liste des utilisateurs&lt;/li&gt;
 *   &lt;li&gt;Création de nouveaux utilisateurs avec chiffrement du mot de passe&lt;/li&gt;
 *   &lt;li&gt;Modification des utilisateurs existants&lt;/li&gt;
 *   &lt;li&gt;Suppression d'utilisateurs&lt;/li&gt;
 *   &lt;li&gt;Validation des données avec Bean Validation&lt;/li&gt;
 * &lt;/ul&gt;
 * 
 * &lt;p&gt;Sécurité : Tous les mots de passe sont automatiquement chiffrés avec BCrypt
 * avant la sauvegarde en base de données. Lors de la modification, le mot de passe
 * existant est masqué pour des raisons de sécurité.&lt;/p&gt;
 * 
 * @author Poseidon Trading App
 * @version 1.0
 * @since 1.0
 */
@Controller
<span class="fc" id="L42">public class UserController {</span>
    /** Repository des utilisateurs injecté par Spring pour l'accès aux données */
    @Autowired
    private UserRepository userRepository;

    /**
     * Affiche la liste de tous les utilisateurs de l'application.
     * 
     * &lt;p&gt;Cette méthode récupère tous les utilisateurs depuis le repository
     * et les passe à la vue pour affichage. Elle constitue la page principale
     * de gestion des utilisateurs.&lt;/p&gt;
     * 
     * @param model Le modèle Spring MVC pour passer les données à la vue
     * @return Le nom de la vue Thymeleaf &quot;user/list&quot; contenant la liste des utilisateurs
     */
    @RequestMapping(&quot;/user/list&quot;)
    public String home(Model model)
    {
<span class="nc" id="L60">        model.addAttribute(&quot;users&quot;, userRepository.findAll());</span>
<span class="nc" id="L61">        return &quot;user/list&quot;;</span>
    }

    /**
     * Affiche le formulaire de création d'un nouvel utilisateur.
     * 
     * &lt;p&gt;Cette méthode prépare l'affichage du formulaire de création d'utilisateur.
     * Un objet User vide est automatiquement lié au formulaire pour la saisie
     * des données du nouvel utilisateur.&lt;/p&gt;
     * 
     * @param bid L'objet User vide qui sera lié au formulaire (binding automatique Spring)
     * @return Le nom de la vue Thymeleaf &quot;user/add&quot; contenant le formulaire de création
     */
    @GetMapping(&quot;/user/add&quot;)
    public String addUser(User bid) {
<span class="nc" id="L76">        return &quot;user/add&quot;;</span>
    }

    /**
     * Traite la soumission du formulaire de création d'un utilisateur.
     * 
     * &lt;p&gt;Cette méthode valide les données soumises via Bean Validation, chiffre
     * le mot de passe avec BCrypt pour la sécurité, sauvegarde l'utilisateur
     * en base de données et redirige vers la liste des utilisateurs en cas de succès.
     * En cas d'erreur de validation, elle retourne au formulaire de création.&lt;/p&gt;
     * 
     * &lt;p&gt;Sécurité : Le mot de passe est automatiquement chiffré avec BCrypt
     * avant la sauvegarde pour garantir la sécurité des données.&lt;/p&gt;
     * 
     * @param user L'objet User contenant les données saisies, validé avec Bean Validation
     * @param result Le résultat de la validation Bean Validation
     * @param model Le modèle Spring MVC pour passer les données à la vue
     * @return Redirection vers la liste des utilisateurs en cas de succès, ou retour au formulaire en cas d'erreur
     */
    @PostMapping(&quot;/user/validate&quot;)
    public String validate(@Valid User user, BindingResult result, Model model) {
<span class="nc bnc" id="L97" title="All 2 branches missed.">        if (!result.hasErrors()) {</span>
<span class="nc" id="L98">            BCryptPasswordEncoder encoder = new BCryptPasswordEncoder();</span>
<span class="nc" id="L99">            user.setPassword(encoder.encode(user.getPassword()));</span>
<span class="nc" id="L100">            userRepository.save(user);</span>
<span class="nc" id="L101">            model.addAttribute(&quot;users&quot;, userRepository.findAll());</span>
<span class="nc" id="L102">            return &quot;redirect:/user/list&quot;;</span>
        }
<span class="nc" id="L104">        return &quot;user/add&quot;;</span>
    }

    /**
     * Affiche le formulaire de modification d'un utilisateur existant.
     * 
     * &lt;p&gt;Cette méthode récupère un utilisateur par son ID, masque son mot de passe
     * pour des raisons de sécurité (en le vidant), et passe l'utilisateur au
     * formulaire de modification. Une exception est levée si l'utilisateur
     * n'existe pas.&lt;/p&gt;
     * 
     * &lt;p&gt;Sécurité : Le mot de passe existant est automatiquement masqué (défini à &quot;&quot;)
     * pour éviter d'exposer le hash du mot de passe dans le formulaire.&lt;/p&gt;
     * 
     * @param id L'identifiant de l'utilisateur à modifier
     * @param model Le modèle Spring MVC pour passer les données à la vue
     * @return Le nom de la vue &quot;user/update&quot; contenant le formulaire de modification
     * @throws IllegalArgumentException si l'utilisateur avec l'ID spécifié n'existe pas
     */
    @GetMapping(&quot;/user/update/{id}&quot;)
    public String showUpdateForm(@PathVariable(&quot;id&quot;) Integer id, Model model) {
<span class="nc" id="L125">        User user = userRepository.findById(id).orElseThrow(() -&gt; new IllegalArgumentException(&quot;Invalid user Id:&quot; + id));</span>
<span class="nc" id="L126">        user.setPassword(&quot;&quot;);</span>
<span class="nc" id="L127">        model.addAttribute(&quot;user&quot;, user);</span>
<span class="nc" id="L128">        return &quot;user/update&quot;;</span>
    }

    /**
     * Traite la soumission du formulaire de modification d'un utilisateur.
     * 
     * &lt;p&gt;Cette méthode valide les données modifiées via Bean Validation, chiffre
     * le nouveau mot de passe avec BCrypt, met à jour l'utilisateur en base de
     * données et redirige vers la liste des utilisateurs en cas de succès.
     * En cas d'erreur de validation, elle retourne au formulaire de modification.&lt;/p&gt;
     * 
     * &lt;p&gt;Sécurité : Le mot de passe est systématiquement re-chiffré avec BCrypt,
     * même s'il s'agit du même mot de passe (recommandation de sécurité).&lt;/p&gt;
     * 
     * @param id L'identifiant de l'utilisateur à modifier
     * @param user L'objet User contenant les données modifiées, validé avec Bean Validation
     * @param result Le résultat de la validation Bean Validation
     * @param model Le modèle Spring MVC pour passer les données à la vue
     * @return Redirection vers la liste des utilisateurs en cas de succès, ou retour au formulaire en cas d'erreur
     */
    @PostMapping(&quot;/user/update/{id}&quot;)
    public String updateUser(@PathVariable(&quot;id&quot;) Integer id, @Valid User user,
                             BindingResult result, Model model) {
<span class="nc bnc" id="L151" title="All 2 branches missed.">        if (result.hasErrors()) {</span>
<span class="nc" id="L152">            return &quot;user/update&quot;;</span>
        }

<span class="nc" id="L155">        BCryptPasswordEncoder encoder = new BCryptPasswordEncoder();</span>
<span class="nc" id="L156">        user.setPassword(encoder.encode(user.getPassword()));</span>
<span class="nc" id="L157">        user.setId(id);</span>
<span class="nc" id="L158">        userRepository.save(user);</span>
<span class="nc" id="L159">        model.addAttribute(&quot;users&quot;, userRepository.findAll());</span>
<span class="nc" id="L160">        return &quot;redirect:/user/list&quot;;</span>
    }

    /**
     * Supprime un utilisateur par son identifiant.
     * 
     * &lt;p&gt;Cette méthode récupère l'utilisateur par son ID, le supprime de la base
     * de données et redirige vers la liste des utilisateurs. Une exception est
     * levée si l'utilisateur n'existe pas.&lt;/p&gt;
     * 
     * &lt;p&gt;Attention : Cette opération est irréversible. L'utilisateur et toutes
     * ses données associées seront définitivement supprimés de la base de données.&lt;/p&gt;
     * 
     * @param id L'identifiant de l'utilisateur à supprimer
     * @param model Le modèle Spring MVC pour passer les données à la vue
     * @return Redirection vers la liste des utilisateurs après suppression
     * @throws IllegalArgumentException si l'utilisateur avec l'ID spécifié n'existe pas
     */
    @GetMapping(&quot;/user/delete/{id}&quot;)
    public String deleteUser(@PathVariable(&quot;id&quot;) Integer id, Model model) {
<span class="nc" id="L180">        User user = userRepository.findById(id).orElseThrow(() -&gt; new IllegalArgumentException(&quot;Invalid user Id:&quot; + id));</span>
<span class="nc" id="L181">        userRepository.delete(user);</span>
<span class="nc" id="L182">        model.addAttribute(&quot;users&quot;, userRepository.findAll());</span>
<span class="nc" id="L183">        return &quot;redirect:/user/list&quot;;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>